<!-- ç«‹å³åº”ç”¨ä¸»é¢˜ï¼Œé˜²æ­¢é—ªçƒ -->
<script>
  (function() {
    var theme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', theme);
  })();
</script>

<!-- ä¸è’œå­è®¿é—®ç»Ÿè®¡ (æ–°ç‰ˆæ”¯æŒ page_uvï¼Œæœ¬åœ°æµ‹è¯•ä¼šæ˜¾ç¤º"åŸŸåå·²è¢«ç¦ç”¨"ï¼Œéƒ¨ç½²åæ­£å¸¸) -->
<script src="//cdn.busuanzi.cc/busuanzi/3.6.9/busuanzi.min.js" defer></script>

{% include mathjax.html %}

<!-- Mermaid å›¾è¡¨æ”¯æŒ -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

<!-- TikZJax: åœ¨æµè§ˆå™¨ä¸­ç›´æ¥æ¸²æŸ“ TikZ ä»£ç  -->
<link rel="stylesheet" type="text/css" href="https://tikzjax.com/v1/fonts.css">
<script src="https://tikzjax.com/v1/tikzjax.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const theme = document.documentElement.getAttribute('data-theme') || 'dark';
    mermaid.initialize({
      startOnLoad: true,
      theme: theme === 'light' ? 'neutral' : 'dark',
      themeVariables: theme === 'light' ? {} : {
        primaryColor: '#1a1a1a',
        primaryTextColor: '#b5e853',
        primaryBorderColor: '#b5e853',
        lineColor: '#b5e853',
        secondaryColor: '#0d0d0d',
        tertiaryColor: '#333',
        background: '#1a1a1a',
        mainBkg: '#1a1a1a',
        nodeBorder: '#b5e853',
        clusterBkg: '#0d0d0d',
        clusterBorder: '#b5e853',
        titleColor: '#b5e853',
        edgeLabelBackground: '#1a1a1a'
      }
    });
  });
</script>

<style>
  /* é˜²æ­¢ç§»åŠ¨ç«¯æ¨ªå‘æ»šåŠ¨ */
  html, body {
    overflow-x: hidden;
    max-width: 100vw;
  }

  /* Geek é£æ ¼å¢å¼º */
  body {
    font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
    transition: background-color 0.3s, color 0.3s;
  }

  /* æ·±è‰²ä¸»é¢˜ (é»˜è®¤) */
  :root {
    --bg-color: #1a1a1a;
    --text-color: #b0b0b0;
    --accent-color: #b5e853;
    --link-color: #63c0f5;
    --code-bg: #0d0d0d;
    --border-color: #333;
  }

  /* æµ…è‰²ä¸»é¢˜ */
  [data-theme="light"] {
    --bg-color: #f5f5f5;
    --text-color: #333;
    --accent-color: #2d7d2d;
    --link-color: #0066cc;
    --code-bg: #e8e8e8;
    --border-color: #ccc;
  }

  [data-theme="light"] body,
  [data-theme="light"] .wrapper {
    background: var(--bg-color) !important;
    color: var(--text-color) !important;
  }

  [data-theme="light"] header {
    background: #e0e0e0 !important;
  }

  [data-theme="light"] h1,
  [data-theme="light"] h2,
  [data-theme="light"] h3,
  [data-theme="light"] h4,
  [data-theme="light"] h5,
  [data-theme="light"] h6 {
    color: var(--accent-color) !important;
  }

  [data-theme="light"] a {
    color: var(--link-color) !important;
  }

  [data-theme="light"] code {
    background: #f5f5f5 !important;
    border-color: #d0d0d0 !important;
    color: #c7254e !important;
  }

  [data-theme="light"] pre {
    background: #fafafa !important;
    border-color: #e0e0e0 !important;
    border-left-color: #2d7d2d !important;
  }

  [data-theme="light"] pre code {
    background: transparent !important;
    border: none !important;
    color: #383a42 !important;
  }

  /* æµ…è‰²æ¨¡å¼è¯­æ³•é«˜äº® - One Light é£æ ¼ */
  [data-theme="light"] .highlight .k, [data-theme="light"] .highlight .kd,
  [data-theme="light"] .highlight .kn, [data-theme="light"] .highlight .kp,
  [data-theme="light"] .highlight .kr, [data-theme="light"] .highlight .kt { color: #a626a4 !important; }
  [data-theme="light"] .highlight .n, [data-theme="light"] .highlight .nc,
  [data-theme="light"] .highlight .nf, [data-theme="light"] .highlight .nn { color: #c18401 !important; }
  [data-theme="light"] .highlight .s, [data-theme="light"] .highlight .s1,
  [data-theme="light"] .highlight .s2, [data-theme="light"] .highlight .sb,
  [data-theme="light"] .highlight .sc, [data-theme="light"] .highlight .sd,
  [data-theme="light"] .highlight .se, [data-theme="light"] .highlight .sh,
  [data-theme="light"] .highlight .si, [data-theme="light"] .highlight .sx,
  [data-theme="light"] .highlight .sr, [data-theme="light"] .highlight .ss { color: #50a14f !important; }
  [data-theme="light"] .highlight .m, [data-theme="light"] .highlight .mf,
  [data-theme="light"] .highlight .mh, [data-theme="light"] .highlight .mi,
  [data-theme="light"] .highlight .mo, [data-theme="light"] .highlight .il { color: #986801 !important; }
  [data-theme="light"] .highlight .c, [data-theme="light"] .highlight .c1,
  [data-theme="light"] .highlight .cm, [data-theme="light"] .highlight .cp,
  [data-theme="light"] .highlight .cs { color: #a0a1a7 !important; font-style: italic; }
  [data-theme="light"] .highlight .o, [data-theme="light"] .highlight .ow { color: #0184bc !important; }
  [data-theme="light"] .highlight .p { color: #383a42 !important; }
  [data-theme="light"] .highlight .nv, [data-theme="light"] .highlight .vi,
  [data-theme="light"] .highlight .vg, [data-theme="light"] .highlight .vm { color: #e45649 !important; }
  [data-theme="light"] .highlight .na { color: #986801 !important; }
  [data-theme="light"] .highlight .nt { color: #e45649 !important; }
  [data-theme="light"] .highlight .nb, [data-theme="light"] .highlight .bp { color: #0184bc !important; }

  [data-theme="light"] th {
    background: #d8d8d8 !important;
    color: var(--accent-color) !important;
  }

  [data-theme="light"] th,
  [data-theme="light"] td {
    border-color: var(--border-color) !important;
  }

  /* Top-right toolbar */
  .toolbar {
    position: fixed;
    top: 16px;
    right: 16px;
    display: flex;
    gap: 8px;
    z-index: 1000;
  }

  .toolbar-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    background: var(--code-bg);
    border: 1px solid var(--accent-color);
    color: var(--accent-color);
    cursor: pointer;
    font-family: inherit;
    font-size: 14px;
    font-weight: bold;
    border-radius: 6px;
    transition: all 0.2s;
    text-decoration: none;
  }

  .toolbar-btn:hover {
    background: var(--accent-color);
    color: var(--bg-color);
    text-decoration: none;
  }

  .toolbar-btn.disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  .toolbar-btn.disabled:hover {
    background: var(--code-bg);
    color: var(--accent-color);
  }

  .toolbar-btn svg {
    fill: currentColor;
  }

  @media (max-width: 480px) {
    .toolbar {
      top: 8px;
      right: 8px;
      gap: 6px;
    }
    .toolbar-btn {
      width: 32px;
      height: 32px;
      font-size: 12px;
    }
  }

  /* Footer */
  .site-footer {
    margin-top: 4em;
    padding: 2em 0;
    border-top: 1px dashed var(--accent-color);
    text-align: center;
    color: #666;
    font-size: 0.85em;
  }

  h1, h2, h3, h4, h5, h6 {
    color: #b5e853;
    font-weight: bold;
  }

  h1, h2, h3 {
    border-bottom: 1px dashed #b5e853;
  }

  /* h4/h5/h6 è‡³å°‘å’Œæ­£æ–‡ä¸€æ ·å¤§ï¼Œé€šè¿‡åŠ ç²—åŒºåˆ† */
  h4 {
    font-size: 1.1em;
  }

  h5, h6 {
    font-size: 1em;
  }

  a {
    color: #63c0f5;
  }

  a:hover {
    color: #b5e853;
    text-shadow: 0 0 5px #b5e853;
  }

  code {
    background: #1a1a1a;
    border: 1px solid #333;
    padding: 2px 6px;
    border-radius: 3px;
  }

  pre {
    background: #0d0d0d;
    border: 1px solid #b5e853;
    border-left: 3px solid #b5e853;
    overflow-x: auto;
    padding: 1em;
    border-radius: 6px;
    line-height: 1.5;
  }

  pre code {
    background: transparent;
    border: none;
    padding: 0;
    color: #abb2bf;
  }

  /* è¯­æ³•é«˜äº® - One Dark é£æ ¼ */
  .highlight .k, .highlight .kd, .highlight .kn, .highlight .kp,
  .highlight .kr, .highlight .kt { color: #c678dd; }  /* å…³é”®å­— - ç´«è‰² */
  .highlight .n, .highlight .nb, .highlight .nc, .highlight .no,
  .highlight .nd, .highlight .ni, .highlight .ne, .highlight .nf,
  .highlight .nl, .highlight .nn, .highlight .nx { color: #e5c07b; }  /* åç§° - é»„è‰² */
  .highlight .s, .highlight .s1, .highlight .s2, .highlight .sb,
  .highlight .sc, .highlight .sd, .highlight .se, .highlight .sh,
  .highlight .si, .highlight .sx, .highlight .sr, .highlight .ss { color: #98c379; }  /* å­—ç¬¦ä¸² - ç»¿è‰² */
  .highlight .m, .highlight .mf, .highlight .mh, .highlight .mi,
  .highlight .mo, .highlight .il { color: #d19a66; }  /* æ•°å­— - æ©™è‰² */
  .highlight .c, .highlight .c1, .highlight .cm, .highlight .cp,
  .highlight .cs { color: #5c6370; font-style: italic; }  /* æ³¨é‡Š - ç°è‰² */
  .highlight .o, .highlight .ow { color: #56b6c2; }  /* è¿ç®—ç¬¦ - é’è‰² */
  .highlight .p { color: #abb2bf; }  /* æ ‡ç‚¹ */
  .highlight .nv, .highlight .vi, .highlight .vg, .highlight .vm { color: #e06c75; }  /* å˜é‡ - çº¢è‰² */
  .highlight .na { color: #d19a66; }  /* å±æ€§ - æ©™è‰² */
  .highlight .nt { color: #e06c75; }  /* æ ‡ç­¾ - çº¢è‰² */

  blockquote {
    border-left: 3px solid #b5e853;
    color: #999;
    font-style: italic;
    margin-left: 0;
    margin-right: 0;
    padding-left: 1em;
  }

  /* è¡¨æ ¼å®¹å™¨ï¼šæ”¯æŒæ¨ªå‘æ»šåŠ¨ */
  .table-wrapper {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    margin: 1em 0;
  }

  table {
    border-collapse: collapse;
    min-width: 100%;
  }

  th, td {
    border: 1px solid #333;
    padding: 8px 12px;
    white-space: nowrap;
  }

  th {
    background: #1a1a1a;
    color: #b5e853;
  }

  /* MathJax å…¬å¼å®¹å™¨ï¼šæ”¯æŒæ¨ªå‘æ»šåŠ¨ */
  mjx-container {
    overflow-x: auto;
    overflow-y: hidden;
    max-width: 100%;
    -webkit-overflow-scrolling: touch;
  }

  /* å—çº§å…¬å¼é¢å¤–å¤„ç† */
  mjx-container[display="true"] {
    display: block !important;
    overflow-x: auto;
    overflow-y: hidden;
    padding: 0.5em 0;
    margin: 0.5em 0;
  }

  /* ç§»åŠ¨ç«¯å…¬å¼ç¼©å° */
  @media (max-width: 600px) {
    mjx-container {
      font-size: 90% !important;
    }
    mjx-container[display="true"] {
      font-size: 85% !important;
    }
  }

  @media (max-width: 400px) {
    mjx-container {
      font-size: 80% !important;
    }
    mjx-container[display="true"] {
      font-size: 75% !important;
    }
  }

  /* Mermaid å›¾è¡¨æ ·å¼ */
  .mermaid {
    background: #0d0d0d;
    border: 1px solid #b5e853;
    border-radius: 6px;
    padding: 1em;
    margin: 1em 0;
    text-align: center;
  }

  [data-theme="light"] .mermaid {
    background: #f8f8f8;
    border-color: #2d7d2d;
  }

  /* TikZ å›¾è¡¨æ ·å¼ */
  .tikz-container {
    background: #0d0d0d;
    border: 1px solid #b5e853;
    border-radius: 6px;
    padding: 1em;
    margin: 1em 0;
    text-align: center;
    overflow-x: auto;
  }

  [data-theme="light"] .tikz-container {
    background: #f8f8f8;
    border-color: #2d7d2d;
  }

  /* TikZJax è¾“å‡ºåè‰²é€‚é…æ·±è‰²ä¸»é¢˜ */
  .tikz-container svg {
    filter: invert(1) hue-rotate(180deg);
  }

  [data-theme="light"] .tikz-container svg {
    filter: none;
  }

  /* æœ¬åœ°ç¼–è¯‘çš„ SVG å›¾ç‰‡æ·±è‰²æ¨¡å¼é€‚é… */
  img[src*="/assets/figures/"] {
    filter: invert(1) hue-rotate(180deg);
    max-width: 100%;
    height: auto;
    display: block;
    margin: 1em auto;
    background: transparent;
  }

  [data-theme="light"] img[src*="/assets/figures/"] {
    filter: none;
  }

  /* å›åˆ°é¡¶éƒ¨æŒ‰é’® */
  #back-to-top {
    position: fixed;
    bottom: 24px;
    right: 24px;
    width: 44px;
    height: 44px;
    background: var(--code-bg);
    border: 2px solid var(--accent-color);
    color: var(--accent-color);
    font-size: 20px;
    font-weight: bold;
    border-radius: 50%;
    cursor: pointer;
    opacity: 0.7;
    transition: all 0.3s ease;
    z-index: 999;
  }

  #back-to-top:hover {
    opacity: 1;
    background: var(--accent-color);
    color: var(--bg-color);
    transform: translateY(-3px);
  }

  @media (max-width: 480px) {
    #back-to-top {
      bottom: 16px;
      right: 16px;
      width: 40px;
      height: 40px;
      font-size: 18px;
    }
  }
</style>

<script>
  // ä¸»é¢˜åˆ‡æ¢
  function toggleTheme() {
    const html = document.documentElement;
    const current = html.getAttribute('data-theme');
    const next = current === 'light' ? 'dark' : 'light';
    html.setAttribute('data-theme', next);
    localStorage.setItem('theme', next);
    updateButton(next);
    updateGiscusTheme(next);
  }

  // æ›´æ–° Giscus ä¸»é¢˜
  function updateGiscusTheme(theme) {
    const iframe = document.querySelector('iframe.giscus-frame');
    if (iframe) {
      iframe.contentWindow.postMessage(
        { giscus: { setConfig: { theme: theme === 'light' ? 'light' : 'dark' } } },
        'https://giscus.app'
      );
    }
  }

  function updateButton(theme) {
    const btn = document.getElementById('theme-btn');
    if (btn) {
      btn.textContent = theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
      btn.title = theme === 'light' ? 'Switch to Dark Mode' : 'Switch to Light Mode';
    }
  }

  // å›åˆ°é¡¶éƒ¨
  function scrollToTop() {
    document.documentElement.scrollTo({ top: 0, behavior: 'smooth' });
    document.body.scrollTo({ top: 0, behavior: 'smooth' });
  }

  // é¡µé¢åŠ è½½æ—¶æ¢å¤ä¸»é¢˜
  document.addEventListener('DOMContentLoaded', function() {
    const saved = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', saved);
    updateButton(saved);

    // æ–‡ç« å†…å®¹ä¸­çš„å¤–éƒ¨é“¾æ¥åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€
    document.querySelectorAll('#main_content a').forEach(function(link) {
      if (link.hostname !== window.location.hostname) {
        link.setAttribute('target', '_blank');
        link.setAttribute('rel', 'noopener noreferrer');
      }
    });

    // ç»™è¡¨æ ¼æ·»åŠ æ»šåŠ¨å®¹å™¨
    document.querySelectorAll('table').forEach(function(table) {
      if (!table.parentElement.classList.contains('table-wrapper')) {
        const wrapper = document.createElement('div');
        wrapper.className = 'table-wrapper';
        table.parentNode.insertBefore(wrapper, table);
        wrapper.appendChild(table);
      }
    });

  });
</script>
