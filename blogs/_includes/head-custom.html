{% include mathjax.html %}

<!-- Mermaid å›¾è¡¨æ”¯æŒ -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

<!-- TikZJax: åœ¨æµè§ˆå™¨ä¸­ç›´æ¥æ¸²æŸ“ TikZ ä»£ç  -->
<link rel="stylesheet" type="text/css" href="https://tikzjax.com/v1/fonts.css">
<script src="https://tikzjax.com/v1/tikzjax.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const theme = document.documentElement.getAttribute('data-theme') || 'dark';
    mermaid.initialize({
      startOnLoad: true,
      theme: theme === 'light' ? 'neutral' : 'dark',
      themeVariables: theme === 'light' ? {} : {
        primaryColor: '#1a1a1a',
        primaryTextColor: '#b5e853',
        primaryBorderColor: '#b5e853',
        lineColor: '#b5e853',
        secondaryColor: '#0d0d0d',
        tertiaryColor: '#333',
        background: '#1a1a1a',
        mainBkg: '#1a1a1a',
        nodeBorder: '#b5e853',
        clusterBkg: '#0d0d0d',
        clusterBorder: '#b5e853',
        titleColor: '#b5e853',
        edgeLabelBackground: '#1a1a1a'
      }
    });
  });
</script>

<style>
  /* é˜²æ­¢ç§»åŠ¨ç«¯æ¨ªå‘æ»šåŠ¨ */
  html, body {
    overflow-x: hidden;
    max-width: 100vw;
  }

  /* Geek é£æ ¼å¢å¼º */
  body {
    font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
    transition: background-color 0.3s, color 0.3s;
  }

  /* æ·±è‰²ä¸»é¢˜ (é»˜è®¤) */
  :root {
    --bg-color: #1a1a1a;
    --text-color: #b0b0b0;
    --accent-color: #b5e853;
    --link-color: #63c0f5;
    --code-bg: #0d0d0d;
    --border-color: #333;
  }

  /* æµ…è‰²ä¸»é¢˜ */
  [data-theme="light"] {
    --bg-color: #f5f5f5;
    --text-color: #333;
    --accent-color: #2d7d2d;
    --link-color: #0066cc;
    --code-bg: #e8e8e8;
    --border-color: #ccc;
  }

  [data-theme="light"] body,
  [data-theme="light"] .wrapper {
    background: var(--bg-color) !important;
    color: var(--text-color) !important;
  }

  [data-theme="light"] header {
    background: #e0e0e0 !important;
  }

  [data-theme="light"] h1,
  [data-theme="light"] h2,
  [data-theme="light"] h3 {
    color: var(--accent-color) !important;
  }

  [data-theme="light"] a {
    color: var(--link-color) !important;
  }

  [data-theme="light"] code,
  [data-theme="light"] pre {
    background: var(--code-bg) !important;
    border-color: var(--border-color) !important;
  }

  /* Top-right toolbar */
  .toolbar {
    position: fixed;
    top: 16px;
    right: 16px;
    display: flex;
    gap: 8px;
    z-index: 1000;
  }

  .toolbar-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    background: var(--code-bg);
    border: 1px solid var(--accent-color);
    color: var(--accent-color);
    cursor: pointer;
    font-family: inherit;
    font-size: 14px;
    font-weight: bold;
    border-radius: 6px;
    transition: all 0.2s;
    text-decoration: none;
  }

  .toolbar-btn:hover {
    background: var(--accent-color);
    color: var(--bg-color);
    text-decoration: none;
  }

  .toolbar-btn.disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  .toolbar-btn.disabled:hover {
    background: var(--code-bg);
    color: var(--accent-color);
  }

  .toolbar-btn svg {
    fill: currentColor;
  }

  @media (max-width: 480px) {
    .toolbar {
      top: 8px;
      right: 8px;
      gap: 6px;
    }
    .toolbar-btn {
      width: 32px;
      height: 32px;
      font-size: 12px;
    }
  }

  /* Footer */
  .site-footer {
    margin-top: 4em;
    padding: 2em 0;
    border-top: 1px dashed var(--accent-color);
    text-align: center;
    color: #666;
    font-size: 0.85em;
  }

  h1, h2, h3 {
    color: #b5e853;
    border-bottom: 1px dashed #b5e853;
  }

  a {
    color: #63c0f5;
  }

  a:hover {
    color: #b5e853;
    text-shadow: 0 0 5px #b5e853;
  }

  code {
    background: #1a1a1a;
    border: 1px solid #333;
    padding: 2px 6px;
    border-radius: 3px;
  }

  pre {
    background: #0d0d0d;
    border: 1px solid #b5e853;
    border-left: 3px solid #b5e853;
    overflow-x: auto;
  }

  blockquote {
    border-left: 3px solid #b5e853;
    color: #999;
    font-style: italic;
    margin-left: 0;
    margin-right: 0;
    padding-left: 1em;
  }

  /* è¡¨æ ¼å®¹å™¨ï¼šæ”¯æŒæ¨ªå‘æ»šåŠ¨ */
  .table-wrapper {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    margin: 1em 0;
  }

  table {
    border-collapse: collapse;
    min-width: 100%;
  }

  th, td {
    border: 1px solid #333;
    padding: 8px 12px;
    white-space: nowrap;
  }

  th {
    background: #1a1a1a;
    color: #b5e853;
  }

  /* MathJax å…¬å¼å®¹å™¨ï¼šæ”¯æŒæ¨ªå‘æ»šåŠ¨ */
  mjx-container {
    overflow-x: auto;
    overflow-y: hidden;
    max-width: 100%;
    -webkit-overflow-scrolling: touch;
  }

  /* å—çº§å…¬å¼é¢å¤–å¤„ç† */
  mjx-container[display="true"] {
    display: block !important;
    overflow-x: auto;
    overflow-y: hidden;
    padding: 0.5em 0;
    margin: 0.5em 0;
  }

  /* ç§»åŠ¨ç«¯å…¬å¼ç¼©å° */
  @media (max-width: 600px) {
    mjx-container {
      font-size: 90% !important;
    }
    mjx-container[display="true"] {
      font-size: 85% !important;
    }
  }

  @media (max-width: 400px) {
    mjx-container {
      font-size: 80% !important;
    }
    mjx-container[display="true"] {
      font-size: 75% !important;
    }
  }

  /* Mermaid å›¾è¡¨æ ·å¼ */
  .mermaid {
    background: #0d0d0d;
    border: 1px solid #b5e853;
    border-radius: 6px;
    padding: 1em;
    margin: 1em 0;
    text-align: center;
  }

  [data-theme="light"] .mermaid {
    background: #f8f8f8;
    border-color: #2d7d2d;
  }

  /* TikZ å›¾è¡¨æ ·å¼ */
  .tikz-container {
    background: #0d0d0d;
    border: 1px solid #b5e853;
    border-radius: 6px;
    padding: 1em;
    margin: 1em 0;
    text-align: center;
    overflow-x: auto;
  }

  [data-theme="light"] .tikz-container {
    background: #f8f8f8;
    border-color: #2d7d2d;
  }

  /* TikZJax è¾“å‡ºåè‰²é€‚é…æ·±è‰²ä¸»é¢˜ */
  .tikz-container svg {
    filter: invert(1) hue-rotate(180deg);
  }

  [data-theme="light"] .tikz-container svg {
    filter: none;
  }
</style>

<script>
  // ä¸»é¢˜åˆ‡æ¢
  function toggleTheme() {
    const html = document.documentElement;
    const current = html.getAttribute('data-theme');
    const next = current === 'light' ? 'dark' : 'light';
    html.setAttribute('data-theme', next);
    localStorage.setItem('theme', next);
    updateButton(next);
  }

  function updateButton(theme) {
    const btn = document.getElementById('theme-btn');
    if (btn) {
      btn.textContent = theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
      btn.title = theme === 'light' ? 'Switch to Dark Mode' : 'Switch to Light Mode';
    }
  }

  // é¡µé¢åŠ è½½æ—¶æ¢å¤ä¸»é¢˜
  document.addEventListener('DOMContentLoaded', function() {
    const saved = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', saved);
    updateButton(saved);

    // æ–‡ç« å†…å®¹ä¸­çš„å¤–éƒ¨é“¾æ¥åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€
    document.querySelectorAll('#main_content a').forEach(function(link) {
      if (link.hostname !== window.location.hostname) {
        link.setAttribute('target', '_blank');
        link.setAttribute('rel', 'noopener noreferrer');
      }
    });

    // ç»™è¡¨æ ¼æ·»åŠ æ»šåŠ¨å®¹å™¨
    document.querySelectorAll('table').forEach(function(table) {
      if (!table.parentElement.classList.contains('table-wrapper')) {
        const wrapper = document.createElement('div');
        wrapper.className = 'table-wrapper';
        table.parentNode.insertBefore(wrapper, table);
        wrapper.appendChild(table);
      }
    });
  });
</script>
